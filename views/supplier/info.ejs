<!DOCTYPE html>
<html>
<head>
    <title>Supplier Information</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <%- include('../partials/navbar') %>
    
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Supplier Information (Read Mode)</h2>
            <a href="/supplier/add" class="btn btn-retro rounded-pill px-4">
                <i class="bi bi-plus-lg"></i> Add Supplier
            </a>
        </div>

        <div class="status-box mb-4">
            <form action="/supplier/info" method="GET" class="row align-items-end">
        
                <div class="col-md-5">
                    <label class="form-label fw-bold">Search</label>
                    <input type="text" name="search" class="form-control border-dark" 
                    placeholder="ID, Name, Phone or Email..." 
                    value="<%= searchQuery %>">
                </div>

                <div class="col-md-3">
                    <label class="form-label fw-bold">Status Filter</label>
                    <select name="status" class="form-select border-dark">
                        <option value="All">All Status</option>
                        <option value="Active" <%= searchStatus === 'Active' ? 'selected' : '' %>>Active Only</option>
                        <option value="Inactive" <%= searchStatus === 'Inactive' ? 'selected' : '' %>>Inactive Only</option>
                    </select>
                </div>
                <div class="col-md-4 d-flex gap-2">
                    <button type="submit" class="btn btn-retro rounded-pill w-100">
                        <i class="bi bi-search"></i> Search
                    </button>
                    <a href="/supplier/info" class="btn btn-secondary rounded-pill w-50">Reset</a>
                </div>
            </form>
        </div>
        <div class="status-box p-0 overflow-hidden">
            <table class="table table-hover mb-0 text-center align-middle">
                <thead class="table-secondary">
                    <tr>
                        <th>Supplier ID</th>
                        <th>Supplier Name</th>
                        <th>Contact (Phone / Email)</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (suppliers.length === 0) { %>
                        <tr><td colspan="5" class="py-4 text-muted">No suppliers found.</td></tr>
                    <% } %>
                    <% suppliers.forEach(s => { %>
                        <tr>
                            <td class="fw-bold"><%= s.supplier_id %></td>
                            <td><%= s.supplier_name %></td>
                            <td class="text-start ps-5">
                                <div><i class="bi bi-telephone-fill text-muted me-2"></i><%= s.phone %></div>
                                <div><i class="bi bi-envelope-fill text-muted me-2"></i><%= s.email %></div>
                            </td>
                            <td>
                                <% if (s.status === 'Active') { %>
                                    <span class="badge bg-success rounded-pill px-3">Active</span>
                                <% } else { %>
                                    <span class="badge bg-secondary rounded-pill px-3">Inactive</span>
                                <% } %>
                            </td>
                            <td>
                                <a href="/supplier/edit/<%= s.id %>" class="btn btn-sm btn-outline-primary me-1">
                                    <i class="bi bi-pencil-square"></i> Edit
                                </a>

                                <form action="/supplier/delete/<%= s.id %>?_method=DELETE" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this supplier?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i> Del
                                    </button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'true') {
            Swal.fire({
                icon: 'success',
                title: 'Done!',
                text: urlParams.get('msg'),
                confirmButtonColor: '#8A2BE2'
            }).then(() => window.history.replaceState({}, document.title, window.location.pathname));
        }
    </script>
</body>
</html>