<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <%- include('partials/navbar') %>
    
    <div class="container mt-4">
        <h2 class="text-center mb-4">Real-Time Statistics</h2>
        
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="status-box">
                    <h5>Sourcing Project Status</h5>
                    <canvas id="prChart"></canvas>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="status-box">
                    <h5>Procurement Spend</h5>
                    <h3>$ <%= stats.totalSpend %></h3>
                    <p>Total PO Amount</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('prChart').getContext('2d');
        // 把後端傳來的數據轉為 JSON
        // const prData = <%- JSON.stringify(stats.pr) %>;
        // 如果 stats.pr 存在就轉 JSON，否則給空陣列，避免錯誤
        const prData = <%- (stats && stats.pr) ? JSON.stringify(stats.pr) : '[]' %>;

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: prData.map(d => d.status || 'Unknown'),
                datasets: [{
                    data: prData.map(d => d.count),
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                }]
            }
        });
    </script>
</body>
</html>